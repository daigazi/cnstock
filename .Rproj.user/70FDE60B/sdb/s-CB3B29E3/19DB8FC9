{
    "contents" : "source(\"cnstock.R\")\n#加载沪深两市股票数据\ncnstock$methods(\n        loadStockName=function(){\n                # load stock name from web\n                library(rvest)\n                library(RCurl)\n                library(XML)\n                url=\"http://bbs.10jqka.com.cn/codelist.html\"\n                web=read_html(url,encoding = \"GBK\")\n                stockName=web  %>% html_nodes(\".bbsilst_wei3 a\") %>% html_text() \n                stockName=stockName[-1]\n                stockName=iconv(x = stockName,from = \"utf-8\",to = \"GBK\")\n                if(save){\n                        if(file.exists(path)){\n                                dir_path=paste(path,\"/stockName.csv\",sep=\"\")      \n                                write.csv(x=stockName,file=dir_path)   \n                        }\n                        else{\n                                \n                                dir.create(path = path,recursive = T)\n                                dir_path=paste(path,\"/stockName.csv\",sep=\"\")\n                                write.csv(x=stockName,file=dir_path) \n                        }  \n                }\n                else{\n                        return(stockName)\n                }\n                Sys.sleep(sleepSec)\n        }\n)\ncnstock$trace(loadStockName,browser) #用来调试loadStockName的\nstock60000$loadStockName()\n#下载网易网页csv数据\ncnstock$methods(\n        loadCsvData=function(Csvname=\"主要财务指标\",type=\"mfi\"){\n                library(rvest)\n                library(RCurl)\n                library(XML)\n                #baseUrl=paste(baseUrl,stockNo,sep=\"\")\n                alltype=as.vector(urldf[,1])\n                #print(type %in% alltype)\n                if(type %in% alltype){\n                        baseUrl=urldf[urldf$name==type,][1,2]\n                        appendUrl=urldf[urldf$name==type,][1,3]  \n                }else{\n                        stop(\"type is wrong\") \n                }\n                url=paste(baseUrl,stockNo,appendUrl,sep=\"\")\n                if(url.exists(url)){\n                        tmp=getBinaryURL(url = url,RCurlheader=RCurlheader)\n                }else{\n                        stop(\"网页不存在\")\n                }\n                #tmp=getBinaryURL(url = url)\n                dir_path=paste(path,\"/\",stockNo,sep=\"\")\n                if(file.exists(dir_path)){\n                        note=file(paste(dir_path,\"/\",Csvname,\".csv\",sep=\"\"),open = \"wb\")\n                        writeBin(tmp, note)\n                        close(note)\n                }\n                else{\n                        dir.create(path = dir_path,recursive = T) \n                        note=file(paste(dir_path,\"/\",Csvname,\".csv\",sep=\"\"),open = \"wb\")\n                        writeBin(tmp, note)\n                        close(note) \n                }\n                Sys.sleep(sleepSec)\n        }\n)\nstock60000=cnstock$new()\nstock60000$loadCsvData(Csvname=\"主要财务指标\",type=\"mfi\")\nstock60000$loadCsvData(\"偿还能力\",\"pay\")\nstock60000$loadCsvData(\"盈利能力\",\"prof\")\nstock60000$loadCsvData(\"成长能力\",\"grow\")\nstock60000$loadCsvData(\"资产负债表\",\"balance\")\nstock60000$loadCsvData(\"利润表\",\"income\")\nstock60000$loadCsvData(\"现金流量表\",\"cash\")\nstock60000$loadCsvData(\"产品比例表\",\"product\")\nstock60000$loadCsvData(\"行业比例表\",\"industry\")\nstock60000$loadCsvData(\"地域比例表\",\"region\")\n#股票实时价格\ncnstock$methods(\n        realTimePrice=function(){\n                library(rvest)\n                library(RCurl)\n                library(XML)\n                url=\"http://quotes.money.163.com/0\"\n                url=paste(url,stockNo,\".html#01a02\",sep=\"\")\n                web=read_html(x = url,encoding = \"utf-8\")\n                realtimeprice=web %>% html_nodes(\".bottom_line .cGreen\") %>% html_text()\n                return(realtimeprice)\n                Sys.sleep(sleepSec)\n        }\n)\ncnstock$trace( realTimePrice,browser )\nstock60000$realTimePrice()\n\n#公司简介\ncnstock$methods(\n        ComIntro=function(){\n                library(rvest)\n                library(RCurl)\n                library(XML)\n                #baseUrl=paste(baseUrl,stockNo,sep=\"\")\n                alltype=as.vector(urldf[,1])\n                type=\"intro\"\n                if(type %in% alltype){\n                        baseUrl=urldf[urldf$name==type,][1,2]\n                        appendUrl=urldf[urldf$name==type,][1,3]  \n                }else{\n                        stop(\"type is wrong\") \n                }\n                web=paste(baseUrl,stockNo,appendUrl,sep=\"\")\n                webpage=getURL(url = web,.encoding = \"utf-8\")\n                data=readHTMLTable(doc = webpage,header = T,colClasses = \"character\", trim=T, stringsAsFactors = FALSE)\n                #公司基本信息\n                ComIntro=data[[4]]\n                colnames(ComIntro)=c(\"value\",\"name\",\"value\",\"name\")\n                ComIntro=rbind(ComIntro[,c(1,2)],ComIntro[,c(3,4)])\n                ComIntro=ComIntro[complete.cases(ComIntro),]\n                return(ComIntro)\n                Sys.sleep(sleepSec)\n        }\n)\nstock60000=cnstock$new()\ndf=stock60000$ComIntro()\n#市净率和市盈率图片下载\ncnstock$methods(\n        loadPic=function(name=\"历史市净率\",type=\"pb\",days=2000){\n                library(RCurl)\n                png_pe=c(\"PE\",\"Pe\",\"pe\")\n                png_pb=c(\"PB\",\"Pb\",\"pb\")\n                if(type %in% png_pe){\n                        baseUrl=\"http://biz.finance.sina.com.cn/company/compare/img_syl_compare.php?stock_code=\"\n                        appendUrl=\",&limit=\"\n                        url=paste(baseUrl,stockNo,appendUrl,days,sep=\"\")\n                }else if(type %in% png_pb){\n                        baseUrl=\"http://biz.finance.sina.com.cn/company/compare/img_sjl_compare.php?stock_code=\"\n                        appendUrl=\",&limit=\"\n                        url=paste(baseUrl,stockNo,appendUrl,days,sep=\"\")\n                }else{\n                    stop(\"type should be pe or pb\")    \n                }       \n                Pic=getBinaryURL(url = url,httpheader=RCurlheader)\n                dir_path=paste(path,\"/\",stockNo,sep=\"\")\n                if(file.exists(dir_path)){\n                        note=file(paste(dir_path,\"/\",name,\".png\",sep=\"\"),open = \"wb\")\n                        writeBin(Pic, note)\n                        close(note)\n                }\n                else{\n                        dir.create(path = dir_path,recursive = T) \n                        note=file(paste(dir_path,\"/\",name,\".png\",sep=\"\"),open = \"wb\")\n                        writeBin(Pic, note)\n                        close(note) \n                }\n        }        \n)\nstock60000=cnstock$new()\nstock60000$loadPic(days=5000)\nstock60000$loadPic(name=\"历史市盈率\",type=\"pe\",days=2000)",
    "created" : 1449146513516.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "3|33|29|8|\n56|42|60|16|\n61|21|66|16|\n83|33|93|8|\n100|28|123|8|\n129|59|157|8|\n",
    "hash" : "77146192",
    "id" : "19DB8FC9",
    "lastKnownWriteTime" : 1449217661,
    "path" : "D:/Git/cnstock/methods.R",
    "project_path" : "methods.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}